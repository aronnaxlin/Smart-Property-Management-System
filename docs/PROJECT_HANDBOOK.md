# 智慧物业管理系统 - 项目综合手册

## 1. 项目概况

### 1.1 项目简介
本项目旨在通过 Java 技术栈构建一个现代化的“智慧物业管理系统”。系统不仅涵盖基础的档案与费用管理，还通过数据可视化提供决策支持，并通过集成式 AI 助手提升人机交互体验。

### 1.2 核心目标
- **基础管理**：实现小区用户、房产、费用的全生命周期管理。
- **费用控制**：记录每一笔收支流水，实现欠费自动筛选与催缴。
- **硬性拦截**：实施“欠费锁定”机制，欠缴物业费/取暖费时，禁止水电卡充值。
- **便捷查询**：提供基于房号、姓名等多维度的快速检索。
- **智能化**：集成 AI 助手进行业务指引，提供可视化决策看板。

---

## 2. 系统架构与设计

### 2.1 技术架构
- **后端**：Java (Spring Boot / Servlet), JDBC 持久化。
- **数据库**：MySQL (遵循 3NF 范式，针对核心业务优化)。
- **前端**：Web (HTML5, CSS3, JavaScript)，集成 ECharts 可视化。
- **外部集成**：阿里云通义千问 API。

### 2.2 核心模块
1. **基础管理模块**：业主档案、房产资源维护。
2. **费用管理模块**：费用收缴、欠费分析、业务拦截。
3. **智慧生活模块**：水电卡自助管理、AI 智能助手。
4. **可视化决策**：财务概况看板、欠费告警系统。

### 2.3 数据库设计
系统包含以下核心实体表：
- **User (用户表)**：系统登录用户。
- **Owner (业主表)**：业主详细信息。
- **Property (房产表)**：房产资源及状态。
- **Fee (账单表)**：物业费、取暖费等账单。
- **UtilityCard (水电卡表)**：水卡、电卡余额及状态。

*(详细 E-R 图与数据字典请参考设计文档)*

---

## 3. 核心业务逻辑规范

### 3.1 钱包与水电卡联动机制
为模拟真实物业场景，系统设立“用户钱包”与“水电卡”双轨支付模式：

1.  **账户体系**：
    *   **水电卡**：独立管理水费、电费。一户一水卡、一电卡。
    *   **用户钱包**：每个用户拥有一个钱包，用于支付物业费、取暖费，并可向水电卡充值。

2.  **支付规则**：
    *   水费/电费 **必须** 从对应的水卡/电卡余额扣除。
    *   水卡/电卡余额 **可以通过** 用户钱包充值。

3.  **欠费硬拦截 (Critical Logic)**：
    *   **规则**：当用户存在未缴纳的物业费或取暖费（即钱包支付类账单未结清）时，**禁止**向水卡或电卡充值。
    *   **流程**：用户发起充值 -> 系统检查 `Fee` 表中该房产是否存在 `is_paid = 0` 的记录 -> 若存在，拦截操作并提示“请先缴纳欠费” -> 若无，允许充值。

---

## 4. 开发者指南

### 4.1 环境配置

#### 数据库配置
1.  编辑 `src/main/resources/db.properties`：
    ```properties
    db.url=jdbc:mysql://localhost:3306/property_management?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8
    db.username=root
    db.password=你的密码
    ```
2.  初始化数据：
    ```bash
    mysql -u root -p < sql/schema.sql
    mysql -u root -p < sql/data.sql
    ```

#### AI 服务配置
复制 `.env.example` 为 `.env` 并配置：
```properties
# 阿里云通义千问示例
OPENAI_API_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
OPENAI_API_KEY=sk-your-api-key
OPENAI_MODEL_NAME=qwen-plus
```

### 4.2 命令行测试 (CLI Test)
项目包含 CLI 测试工具以验证数据库连接与基础功能。

**运行步骤**：
1.  编译项目：`mvn clean compile`
2.  运行测试：`mvn exec:java -Dexec.mainClass="site.aronnax.CLITest"`

**功能**：
- 查询用户、房产、账单数据。
- 执行自定义 SQL。

### 4.3 故障排查
- **AI 服务不可用**：检查环境变量配置及网络连通性。
- **数据库连接失败**：检查 MySQL 服务状态及 `db.properties` 账号密码。
